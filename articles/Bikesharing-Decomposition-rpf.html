<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bikesharing: Decomposition with Random Planted Forest • glex</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bikesharing: Decomposition with Random Planted Forest">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">glex</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/glex.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Bikesharing-Decomposition-rpf.html">Bikesharing: Decomposition with Random Planted Forest</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/PlantedML/glex/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Bikesharing: Decomposition with Random Planted Forest</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PlantedML/glex/blob/master/vignettes/articles/Bikesharing-Decomposition-rpf.Rmd" class="external-link"><code>vignettes/articles/Bikesharing-Decomposition-rpf.Rmd</code></a></small>
      <div class="d-none name"><code>Bikesharing-Decomposition-rpf.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PlantedML/glex" class="external-link">glex</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PlantedML/randomPlantedForest" class="external-link">randomPlantedForest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com" class="external-link">ISLR2</a></span><span class="op">)</span> <span class="co"># For Bikeshare dataset</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co"># To arrange plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2023</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="preparing-the-data">Preparing the Data<a class="anchor" aria-label="anchor" href="#preparing-the-data"></a>
</h2>
<p>First we load the <code>Bikeshare</code> data from the
<code>ISLR2</code> package, which provides the dataset published at the
<a href="https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset" class="external-link">UCI
Machine Learning Repository</a>.</p>
<blockquote>
<p>This data set contains the hourly and daily count of rental bikes
between years 2011 and 2012 in Capital bikeshare system, along with
weather and seasonal information.</p>
</blockquote>
<p>The outcome is going to be <code>bikers</code>, the total number of
bikers in the system.</p>
<p>The predictors of interest in our case are going to be the
following:</p>
<ul>
<li>
<code>hr</code>: Hour of day, 0 to 23 hours.</li>
<li>
<code>temp</code>: Normalized temperature in Celsius</li>
<li>
<code>workingday</code>: Binary value indicating whether it’s a work
day (1) or not (0)</li>
</ul>
<p>We recode the <code>hr</code> variable from a 24-level
<code>factor</code> to a numeric column.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Bikeshare</span><span class="op">)</span></span>
<span><span class="va">bike</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">Bikeshare</span><span class="op">)</span></span>
<span><span class="va">bike</span><span class="op">[</span>, <span class="va">hr</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">bike</span><span class="op">[</span>, <span class="va">workingday</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">workingday</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No Workingday"</span>, <span class="st">"Workingday"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">bike</span><span class="op">[</span>, <span class="va">season</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">season</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Winter"</span>, <span class="st">"Spring"</span>, <span class="st">"Summer"</span>, <span class="st">"Fall"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Only one observation with this condition, removing it to make space.</span></span>
<span><span class="va">bike</span> <span class="op">&lt;-</span> <span class="va">bike</span><span class="op">[</span><span class="va">weathersit</span> <span class="op">!=</span> <span class="st">"heavy rain/snow"</span>, <span class="op">]</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bike</span><span class="op">)</span></span>
<span><span class="co">#&gt;    season   mnth   day    hr holiday weekday    workingday   weathersit  temp</span></span>
<span><span class="co">#&gt;    &lt;fctr&gt; &lt;fctr&gt; &lt;num&gt; &lt;num&gt;   &lt;num&gt;   &lt;num&gt;        &lt;fctr&gt;       &lt;fctr&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: Winter    Jan     1     0       0       6 No Workingday        clear  0.24</span></span>
<span><span class="co">#&gt; 2: Winter    Jan     1     1       0       6 No Workingday        clear  0.22</span></span>
<span><span class="co">#&gt; 3: Winter    Jan     1     2       0       6 No Workingday        clear  0.22</span></span>
<span><span class="co">#&gt; 4: Winter    Jan     1     3       0       6 No Workingday        clear  0.24</span></span>
<span><span class="co">#&gt; 5: Winter    Jan     1     4       0       6 No Workingday        clear  0.24</span></span>
<span><span class="co">#&gt; 6: Winter    Jan     1     5       0       6 No Workingday cloudy/misty  0.24</span></span>
<span><span class="co">#&gt;     atemp   hum windspeed casual registered bikers</span></span>
<span><span class="co">#&gt;     &lt;num&gt; &lt;num&gt;     &lt;num&gt;  &lt;num&gt;      &lt;num&gt;  &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 0.2879  0.81    0.0000      3         13     16</span></span>
<span><span class="co">#&gt; 2: 0.2727  0.80    0.0000      8         32     40</span></span>
<span><span class="co">#&gt; 3: 0.2727  0.80    0.0000      5         27     32</span></span>
<span><span class="co">#&gt; 4: 0.2879  0.75    0.0000      3         10     13</span></span>
<span><span class="co">#&gt; 5: 0.2879  0.75    0.0000      0          1      1</span></span>
<span><span class="co">#&gt; 6: 0.2576  0.75    0.0896      0          1      1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-purification-component-extraction">Fitting, Purification, Component Extraction<a class="anchor" aria-label="anchor" href="#fitting-purification-component-extraction"></a>
</h2>
<p>Next we can fit a Random Planted Forest on the <code>bikers</code>
variable, using a subset of the available predictors. We limit the
model’s complexity by setting <code>max_interaction = 3</code>, as we
are only going to visualize interactions up to the third degree, and
using a higher value here might only marginally improve predictive
performance at the cost of a longer runtime. For our example here, a
smaller model with merely 30 trees suffices. We also <code>purify</code>
the forest to enable the desired decomposition. This step is not
required for global predictions and may take some time, which is why it
is implemented as a separate step.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rp</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://plantedml.com/randomPlantedForest/reference/rpf.html" class="external-link">rpf</a></span><span class="op">(</span></span>
<span>  <span class="va">bikers</span> <span class="op">~</span> <span class="va">day</span> <span class="op">+</span> <span class="va">hr</span> <span class="op">+</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">windspeed</span> <span class="op">+</span> <span class="va">workingday</span> <span class="op">+</span> <span class="va">hum</span> <span class="op">+</span> <span class="va">weathersit</span> <span class="op">+</span> <span class="va">season</span>,</span>
<span>  data <span class="op">=</span> <span class="va">bike</span>,</span>
<span>  max_interaction <span class="op">=</span> <span class="fl">3</span>, ntrees <span class="op">=</span> <span class="fl">50</span>, splits <span class="op">=</span> <span class="fl">100</span>, t_try <span class="op">=</span> <span class="fl">0.9</span>, split_try <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="http://plantedml.com/randomPlantedForest/reference/purify.html" class="external-link">purify</a></span><span class="op">(</span><span class="va">rp</span><span class="op">)</span></span>
<span><span class="co">#&gt; -- Regression Random Planted Forest --</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: bikers ~ day + hr + temp + windspeed + workingday + hum + weathersit +      season </span></span>
<span><span class="co">#&gt; Fit using 8 predictors and 3-degree interactions.</span></span>
<span><span class="co">#&gt; Forest is purified!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Called with parameters:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             loss: L2</span></span>
<span><span class="co">#&gt;           ntrees: 50</span></span>
<span><span class="co">#&gt;  max_interaction: 3</span></span>
<span><span class="co">#&gt;           splits: 100</span></span>
<span><span class="co">#&gt;        split_try: 5</span></span>
<span><span class="co">#&gt;            t_try: 0.9</span></span>
<span><span class="co">#&gt;            delta: 0</span></span>
<span><span class="co">#&gt;          epsilon: 0.1</span></span>
<span><span class="co">#&gt;    deterministic: FALSE</span></span>
<span><span class="co">#&gt;         nthreads: 1</span></span>
<span><span class="co">#&gt;           purify: FALSE</span></span>
<span><span class="co">#&gt;               cv: FALSE</span></span></code></pre></div>
<p>We select the predictors of interest and use <code><a href="../reference/glex.html">glex()</a></code> to
retrieve all predictive components that include them, from main effects
to 3rd degree interactions. The resulting object also contains the
original data as <code>x</code>, which we need for later
visualization.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr"</span>, <span class="st">"temp"</span>, <span class="st">"workingday"</span>, <span class="st">"hum"</span>, <span class="st">"weathersit"</span>, <span class="st">"season"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">components</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/glex.html">glex</a></span><span class="op">(</span><span class="va">rp</span>, <span class="va">bike</span>, predictors <span class="op">=</span> <span class="va">vars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># There's a lot of components...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">components</span><span class="op">$</span><span class="va">m</span>, list.len <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'data.table' and 'data.frame':   8644 obs. of  92 variables:</span></span>
<span><span class="co">#&gt;  $ day                            : num  -40 -40 -40 -40 -40 ...</span></span>
<span><span class="co">#&gt;  $ hr                             : num  -102 -118 -125 -133 -134 ...</span></span>
<span><span class="co">#&gt;  $ temp                           : num  -40.2 -40.4 -40.4 -40.2 -40.2 ...</span></span>
<span><span class="co">#&gt;  $ windspeed                      : num  1.85 1.85 1.85 1.85 1.85 ...</span></span>
<span><span class="co">#&gt;  $ workingday                     : num  0.0162 0.0162 0.0162 0.0162 0.0162 ...</span></span>
<span><span class="co">#&gt;  $ hum                            : num  -14.76 -13.84 -13.84 -5.05 -5.05 ...</span></span>
<span><span class="co">#&gt;  $ weathersit                     : num  4.29 4.29 4.29 4.29 4.29 ...</span></span>
<span><span class="co">#&gt;  $ season                         : num  -24 -24 -24 -24 -24 ...</span></span>
<span><span class="co">#&gt;   [list output truncated]</span></span>
<span><span class="co">#&gt;  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></span></code></pre></div>
<p>Please note that fitting the model, purification, and the extraction
of the components may take some time, depending on available resources
and the size of the data. For example, the above steps took around 300
seconds to complete on GitHub Actions.</p>
</div>
<div class="section level2">
<h2 id="main-effects">Main Effects<a class="anchor" aria-label="anchor" href="#main-effects"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_main</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_main_effect</a></span><span class="op">(</span><span class="va">components</span>, <span class="st">"temp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/plot_components.html">plot_main_effect</a></span><span class="op">(</span><span class="va">components</span>, <span class="st">"hr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/plot_components.html">plot_main_effect</a></span><span class="op">(</span><span class="va">components</span>, <span class="st">"workingday"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_main</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.3</span>, <span class="fl">.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/main-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="way-interactions">2-Way Interactions<a class="anchor" aria-label="anchor" href="#way-interactions"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_2way1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_twoway_effects</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"workingday"</span>, <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_2way2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_twoway_effects</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr"</span>, <span class="st">"workingday"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p_2way3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_twoway_effects</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr"</span>, <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_2way</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">p_2way1</span> <span class="op">/</span> <span class="va">p_2way2</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> <span class="va">p_2way3</span></span>
<span></span>
<span><span class="va">p_2way</span> <span class="op">&lt;-</span> <span class="va">p_2way</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1,2"</span>, <span class="st">"3,1"</span>, <span class="st">"3,3"</span><span class="op">)</span><span class="op">)</span>, tag_prefix <span class="op">=</span> <span class="st">"m("</span>, tag_suffix <span class="op">=</span> <span class="st">")"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_2way</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/twoway-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="way-interaction">3-Way Interaction<a class="anchor" aria-label="anchor" href="#way-interaction"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_3way</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_components.html">plot_threeway_effects</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr"</span>, <span class="st">"temp"</span>, <span class="st">"workingday"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_3way</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/threeway-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="everything-together">Everything Together<a class="anchor" aria-label="anchor" href="#everything-together"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_main</span> <span class="op">/</span> <span class="va">p_2way</span> <span class="op">/</span> <span class="va">p_3way</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.5</span>, <span class="fl">.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/all-effects-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="additional-effects">Additional effects<a class="anchor" aria-label="anchor" href="#additional-effects"></a>
</h2>
<p>All main effects:</p>
<p>Iterating over <code>vars</code> (hr, temp, workingday, hum,
weathersit, season), and passing each to <code>plot_main_effect</code>,
then collecting the plots with <code><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">patchwork::wrap_plots()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="va">plot_main_effect</span>, object <span class="op">=</span> <span class="va">components</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/all-main-effects-1.png" width="960" style="display: block; margin: auto;"></p>
<p>From here we use <code>autoplot</code> for convenience. Internally it
just passes its arguments on to the specialized <code>plot_*</code>
functions, depending on the number of predictors supplied.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"workingday"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/unnamed-chunk-4-1.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"hr"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/unnamed-chunk-4-2.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"weathersit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/unnamed-chunk-4-3.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weathersit"</span>, <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/unnamed-chunk-4-4.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hum"</span>, <span class="st">"temp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/unnamed-chunk-4-5.png" width="864" style="display: block; margin: auto;"></p>
<p>3rd degree interactions can be tricky, if they have any effect at
all.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"hr"</span>, <span class="st">"weathersit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"workingday"</span>, <span class="st">"hr"</span>, <span class="st">"season"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/unnamed-chunk-5-2.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Hard to interpret</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"workingday"</span>, <span class="st">"hr"</span>, <span class="st">"weathersit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/unnamed-chunk-5-3.png" width="864" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># zero effect</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">components</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weathersit"</span>, <span class="st">"season"</span>, <span class="st">"workingday"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bikesharing-Decomposition-rpf_files/figure-html/unnamed-chunk-5-4.png" width="864" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marvin N. Wright, Joseph Theo Meyer, Munir Hiabu, Lukas Burk, Jinyang Liu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
